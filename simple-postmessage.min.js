/* simple postMessage - v0.2.0
 * by Leonardo Dutra (https://github.com/LeoDutra/simple-postmessage)
 * Dual licensed under the MIT and GPL licenses.
 *
 * based on
 *
 * ender postMessage - v0.1.3 - 5/1/2012
 * by Thomas Sturm http://www.sturm.to
 * Dual licensed under the MIT and GPL licenses.
 *
 * based on 
 *
 * jQuery postMessage - v0.5 - 9/11/2009
 * http://benalman.com/projects/jquery-postmessage-plugin/
 * Copyright (c) 2009 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */

(function(c){function n(a){return g?g.stringify(a):a}function p(a){return g?g.parse(a):a}function u(a,d){e?m.push({target:a,hash:d}):(a.location=d,e||(e=setInterval(function(){if(m.length){var a=m.shift();try{a.target.location=a.hash}catch(b){}}else e&&(clearInterval(e),e=0)},120)))}var e=0,h=0,m=[],q,k,l,v=0,r=c.postMessage,g=c.JSON,s=navigator.userAgent.toLowerCase(),t=~s.indexOf("msie")?10>parseInt(s.split("msie")[1],10):!1;c.simplePostMessage=function(a,d,f){d&&(f=f||opener||parent||c,r?(t&&(a=
n(a)),f.postMessage(a,d.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))):u(f,d.replace(/#.*$/,"")+"#--HASH--"+ +new Date+ ++v+"&"+encodeURIComponent(n(a))))};c.simpleReceiveMessage=function(a,d){var f=typeof d;if(r)if(a&&(l&&c.simpleReceiveMessage(),l=function(b){if("string"===f&&b.origin!==d||"function"===f&&!1===d(b.origin)||"[object Array]"===Object.prototype.toString.call(d)&&~d.indexOf(b.origin))return!1;if(t){var c={},e;for(e in b)"function"!==typeof e&&(c[e]=b[e]);b=c;b.data=p(b.data)}a(b)}),c.addEventListener)c[a?
"addEventListener":"removeEventListener"]("message",l,!1);else c[a?"attachEvent":"detachEvent"]("onmessage",l);else h&&(h=clearInterval(h)),a&&(k=document.location.hash,h=setInterval(function(){var b=document.location.hash,c=/^#?--HASH--\d+&/;b!==q&&b!==k&&c.test(b)&&(q=b,document.location.hash=k?k:"",a({data:p(decodeURIComponent(b.replace(c,"").replace(/\+/gim," ")))}))},100))}})(window);
